# Настройки проекта

Настройки проекта <img src="../.gitbook/assets/icon_project-settings.JPG" alt="" data-size="line"> в Chloros позволяют настроить все аспекты обработки изображений, обнаружения калибровочных целей, расчета мультиспектральных индексов и параметров экспорта для вашего проекта. Эти настройки сохраняются вместе с вашим проектом и могут быть сохранены в виде шаблонов для повторного использования в нескольких проектах.

## Доступ к настройкам проекта

Чтобы получить доступ к настройкам проекта:

1. Откройте проект в Chloros
2. Щелкните вкладку **Настройки проекта**  <img src="../.gitbook/assets/icon_project-settings.JPG" alt="" data-size="line"> на левой боковой панели
3. На панели настроек отобразятся все доступные параметры конфигурации, сгруппированные по категориям

***

## Обнаружение целей

Эти настройки контролируют, как Chloros обнаруживает и обрабатывает калибровочные цели на ваших изображениях.

### Минимальная площадь калибровочной выборки (px)

* **Тип**: число
* **Диапазон**: от 0 до 10 000 пикселей
* **По умолчанию**: 25 пикселей
* **Описание**: устанавливает минимальную площадь (в пикселях), необходимую для того, чтобы обнаруженная область считалась действительным образцом калибровочной цели. Меньшие значения позволяют обнаруживать более мелкие цели, но могут увеличить количество ложных срабатываний. Более крупные значения требуют более крупных и четких областей целей для обнаружения.
* **Когда настраивать**:
  * Увеличьте, если вы получаете ложные обнаружения на небольших артефактах изображения.
  * Уменьшите, если ваши цели калибровки выглядят небольшими на изображениях и не обнаруживаются.

### Минимальная кластеризация целей (0-100)

* **Тип**: Число
* **Диапазон**: от 0 до 100
* **По умолчанию**: 60
* **Описание**: Управляет порогом кластеризации для группировки областей с похожими цветами при обнаружении целей калибровки. Более высокие значения требуют группировки более похожих цветов, что приводит к более консервативному обнаружению целей. Более низкие значения допускают большее разнообразие цветов в группе целей.
* **Когда настраивать**:
  * Увеличьте, если цели калибровки разделяются на несколько обнаружений.
  * Уменьшите, если цели калибровки с различиями в цвете не обнаруживаются полностью.

***

## Обработка

Эти настройки контролируют, как Chloros обрабатывает и калибрует ваши изображения.

### Коррекция виньетирования

* **Тип**: Флажок
* **По умолчанию**: Включено (отмечено)
* **Описание**: Применяет коррекцию виньетирования для компенсации затемнения объектива по краям изображений. Виньетирование — это распространенное оптическое явление, при котором углы и края изображения выглядят темнее, чем центр, из-за характеристик объектива.
* **Когда отключать**: отключайте только в том случае, если ваша камера/объектив уже применяют коррекцию виньетирования, или если вы хотите вручную скорректировать виньетирование при постобработке.

### Калибровка отражения / баланс белого

* **Тип**: флажок
* **По умолчанию**: включено (отмечено)
* **Описание**: Включает автоматическую калибровку отражательной способности с использованием обнаруженных калибровочных целей в ваших изображениях. Это нормализует значения отражательной способности во всем наборе данных и обеспечивает стабильные измерения независимо от условий освещения.
* **Когда отключать**: Отключайте только в том случае, если вы хотите обрабатывать необработанные, некалиброванные изображения или если вы используете другой рабочий процесс калибровки.

### Метод дебайеризации

* **Тип**: Выпадающий список
* **Варианты**:
  * Высокое качество (быстрее) — в настоящее время единственный доступный вариант
* **По умолчанию**: Высокое качество (быстрее)
* **Описание**: Выбирает алгоритм демозаикирования, используемый для преобразования необработанных данных датчика с матрицей Байера в полноцветные изображения. Метод «Высокое качество (быстрее)» обеспечивает оптимальный баланс между скоростью обработки и качеством изображения.
* **Примечание**: В будущих версиях Chloros могут быть добавлены дополнительные методы дебайеризации.

### Минимальный интервал повторной калибровки

* **Тип**: Число
* **Диапазон**: от 0 до 3600 секунд
* **По умолчанию**: 0 секунд
* **Описание**: Устанавливает минимальный интервал времени (в секундах) между использованием калибровочных мишеней. При установке значения 0 Chloros будет использовать каждую обнаруженную калибровочную мишень. При установке более высокого значения Chloros будет использовать только калибровочные мишени, разделенные как минимум этим количеством секунд, что сокращает время обработки наборов данных с частыми захватами калибровочных мишеней.
* **Когда настраивать**:
  * Установите значение 0 для максимальной точности калибровки при изменяющихся условиях освещения.
  * Увеличьте значение (например, до 60–300 секунд) для более быстрой обработки, когда освещение остается постоянным и у вас есть частые изображения калибровочных целей.

### Смещение часового пояса датчика освещенности

* **Тип**: Число
* **Диапазон**: от -12 до +12 часов
* **По умолчанию**: 0 часов
* **Описание**: Указывает смещение часового пояса (в часах от UTC) для временных меток данных датчика освещенности. Используется при обработке файлов данных PPK (Post-Processed Kinematic) для обеспечения правильной синхронизации времени между захватом изображений и данными GPS.
* **Когда настраивать**: Установите значение, соответствующее смещению вашего местного часового пояса, если ваши данные PPK используют местное время вместо UTC. Например:
  * Тихоокеанское время: -8 или -7 (в зависимости от перехода на летнее время)
  * Восточное время: -5 или -4 (в зависимости от перехода на летнее время)
  * Центральноевропейское время: +1 или +2 (в зависимости от перехода на летнее время)

### Применить поправки PPK

* **Тип**: Флажок
* **По умолчанию**: Отключено (флажок не установлен)
* **Описание**: Включает использование постобработанных кинематических (PPK) корректировок из регистраторов MAPIR DAQ, содержащих GPS (GNSS). При включении Chloros будет использовать любые файлы журнала .daq, содержащие данные о контактах экспозиции в каталоге вашего проекта, и применять точные корректировки геолокации к вашим изображениям.
* **Требование**: в каталоге проекта должен присутствовать файл журнала .daq с записями о контактах экспозиции
* **Когда включать**: рекомендуется всегда включать корректировку PPK, если в файле журнала .daq есть записи об экспозиции.

### Контакт экспозиции 1

* **Тип**: выпадающий список
* **Видимость**: Видимо только при включенной функции «Применить корректировки PPK» И наличии данных экспозиции для контакта 1.
* **Параметры**:
  * Названия моделей камер, обнаруженных в проекте.
  * «Не использовать» — игнорировать этот контакт экспозиции.
* **По умолчанию**: выбирается автоматически на основе конфигурации проекта.
* **Описание**: назначает определенную камеру контакту экспозиции 1 для синхронизации времени PPK. Контакт экспозиции записывает точное время срабатывания затвора камеры, что имеет решающее значение для точной геолокации PPK.
* **Поведение автовыбора**:
  * Одна камера + один контакт: автоматически выбирает камеру
  * Одна камера + два контакта: контакт 1 автоматически назначается камере
  * Несколько камер: требуется ручной выбор

### Контакт экспозиции 2

* **Тип**: Выпадающий список
* **Видимость**: Виден только при включенной опции «Применить корректировки PPK» И наличии данных экспозиции для контакта 2
* **Опции**:
  * Названия моделей камер, обнаруженных в проекте
  * «Не использовать» — игнорировать этот контакт экспозиции
* **По умолчанию**: Автоматически выбирается на основе конфигурации проекта
* **Описание**: Назначает определенную камеру для контакта экспозиции 2 для синхронизации времени PPK при использовании двух камер.
* **Поведение автоматического выбора**:
  * Одна камера + один контакт: контакт 2 автоматически устанавливается в положение «Не использовать»
  * Одна камера + два контакта: контакт 2 автоматически устанавливается в положение «Не использовать»
  * Несколько камер: требуется ручной выбор
* **Примечание**: Одна и та же камера не может быть назначена одновременно для контакта 1 и контакта 2.

***

## Индекс

Эти настройки позволяют настроить мультиспектральные индексы для анализа и визуализации.

### Добавить индекс

* **Тип**: Специальная панель настройки индекса
* **Описание**: открывает интерактивную панель, на которой можно выбрать и настроить мультиспектральные индексы растительности (NDVI, NDRE, EVI и т. д.) для расчета во время обработки изображений. Можно добавить несколько индексов, каждый со своими настройками визуализации.
* **Доступные индексы**: Система включает более 30 предварительно определенных мультиспектральных индексов, в том числе:
  * NDVI (нормализованный разностный растительный индекс)
  * NDRE (нормализованный разностный RedEdge)
  * EVI (улучшенный индекс растительности)
  * GNDVI, SAVI, OSAVI, MSAVI2
  * И многие другие (полный список см. в разделе [Формулы многоспектральных индексов](multispectral-index-formulas.md))
* **Особенности**:
  * Выбор из предварительно определенных формул индексов
  * Настройка цветовых градиентов визуализации (LUT — таблицы просмотра)
  * Установка пороговых значений для анализа
  * Создание пользовательских формул индексов

### Пользовательские формулы (Функция Chloros+)

* **Тип**: Массив определений пользовательских формул
* **Описание**: Позволяет создавать и сохранять пользовательские формулы мультиспектральных индексов с использованием математических операций над полосами. Пользовательские формулы сохраняются вместе с настройками проекта и могут использоваться так же, как встроенные индексы.
* **Как создать**:
  1. На панели настроек индекса найдите опцию пользовательской формулы.
  2. Определите формулу, используя идентификаторы полос (например, NIR, Red, Green, Blue).
  3. Сохраните формулу с описательным именем.
* **Синтаксис формулы**: поддерживаются стандартные математические операции, в том числе:
  * Арифметика: `+`, `-`, `*`, `/`.
  * Скобки для порядка операций
  * Ссылки на диапазоны: NIR, Red, Green, Blue, RedEdge, Cyan, Orange, NIR1, NIR2

***

## Экспорт

Эти настройки контролируют формат и качество экспортируемых обработанных изображений.

### Калиброванный формат изображения

* **Тип**: выпадающий список
* **Опции**:
  * **TIFF (16-битный)** — несжатый 16-битный формат TIFF
  * **TIFF (32-разрядный, проценты)** — 32-разрядный формат TIFF с плавающей запятой и значениями отражательной способности в процентах
  * **PNG (8-разрядный)** — сжатый 8-разрядный формат PNG
  * **JPG (8-разрядный)** — сжатый 8-разрядный формат JPEG
* **По умолчанию**: TIFF (16-битный)
* **Описание**: Выбор формата файла для сохранения обработанных и откалиброванных изображений.
* **Рекомендации по формату**:
  * **TIFF (16-битный)**: Рекомендуется для научного анализа и профессиональных рабочих процессов. Сохраняет максимальное качество данных без артефактов сжатия. Лучше всего подходит для мультиспектрального анализа и дальнейшей обработки в программном обеспечении GIS.
  * **TIFF (32-битный, проценты)**: Лучше всего подходит для рабочих процессов, требующих значений отражения в процентах (0-100%). Обеспечивает максимальную точность радиометрических измерений.
  * **PNG (8-битный)**: подходит для просмотра в Интернете и общей визуализации. Меньший размер файлов с сжатием без потерь, но уменьшенный динамический диапазон.
  * **JPG (8-битный)**: самый маленький размер файлов, лучше всего подходит только для предварительного просмотра и отображения в Интернете. Использует сжатие с потерями, которое не подходит для научного анализа.

***

## Сохранить шаблон проекта

Эта функция позволяет сохранить текущие настройки проекта в виде шаблона, который можно использовать повторно.

* **Тип**: ввод текста + кнопка «Сохранить»
* **Описание**: введите описательное имя для шаблона настроек и нажмите значок «Сохранить». Шаблон сохранит все текущие настройки проекта (обнаружение целей, параметры обработки, индексы и формат экспорта) для удобного повторного использования в будущих проектах.
* **Варианты использования**:
  * Создание шаблонов для различных систем камер (RGB, мультиспектральная, NIR)
  * Сохранение стандартных конфигураций для определенных типов культур или рабочих процессов анализа
  * Совместное использование единых настроек всей командой
* **Как использовать**:
  1. Настройте все желаемые параметры проекта
  2. Введите название шаблона (например, «RedEdge Survey3 NDVI Стандартный»).
  3. Нажмите значок «Сохранить».
  4. Теперь шаблон можно загрузить при создании новых проектов.

***

## Папка «Сохранить проект»

Этот параметр определяет, где по умолчанию сохраняются новые проекты.

* **Тип**: Отображение пути к каталогу + кнопка «Изменить»
* **По умолчанию**: `C:\Users\[Username]\Chloros Projects`
* **Описание**: Отображает текущий каталог по умолчанию, в котором создаются новые проекты Chloros. Нажмите значок «Изменить», чтобы выбрать другой каталог.
* **Когда изменять**:
  * Установите сетевой диск для совместной работы в команде.
  * Измените на диск с большим объемом памяти для больших наборов данных.
  * Организуйте проекты по годам, клиентам или типам проектов в разных папках.
* **Примечание**: изменение этого параметра влияет только на НОВЫЕ проекты. Существующие проекты остаются в своих исходных местах.

***

## Сохранение настроек

Все настройки проекта автоматически сохраняются вместе с файлом проекта (формат проекта `.mapir`). При повторном открытии проекта все настройки восстанавливаются в том виде, в котором вы их оставили.

### Иерархия настроек

Настройки применяются в следующем порядке:

1. **Системные настройки по умолчанию** — встроенные настройки по умолчанию, определенные Chloros
2. **Настройки шаблона** — если вы загружаете шаблон при создании проекта
3. **Сохраненные настройки проекта** — настройки, сохраненные вместе с файлом проекта
4. **Ручные настройки** — любые изменения, внесенные вами во время текущей сессии

### Настройки и обработка изображений

Большинство изменений настроек (особенно в категориях «Обработка» и «Экспорт») приводят к повторной обработке изображений с учетом новых настроек. Однако некоторые настройки являются «только для экспорта» и не требуют немедленной повторной обработки:

* Сохранить шаблон проекта
* Рабочий каталог
* Калиброванный формат изображения (применяется при экспорте)

***

## Рекомендации

1. **Начните с настроек по умолчанию**: настройки по умолчанию хорошо подходят для большинства систем камер MAPIR и типичных рабочих процессов.
2. **Создайте шаблоны**: после оптимизации настроек для конкретного рабочего процесса или камеры сохраните их в качестве шаблона, чтобы обеспечить согласованность между проектами.
3. **Проведите тестирование перед полной обработкой**: при экспериментах с новыми настройками протестируйте их на небольшом поднаборе изображений, прежде чем обрабатывать весь набор данных.
4. **Документируйте настройки**: используйте описательные имена шаблонов, которые указывают систему камеры, тип обработки и предполагаемое использование (например, «Survey3\_RGB\_NDVI\_Agriculture»).
5. **Выбор формата экспорта**: выберите формат экспорта в зависимости от конечного использования:
   * Научный анализ → TIFF (16-битный или 32-битный)
   * Обработка ГИС → TIFF (16-битный)
   * Быстрая визуализация → PNG (8-битный)
   * Обмен в Интернете → JPG (8-битный)

***

Для получения дополнительной информации о мультиспектральных индексах в Chloros см. страницу [Формулы мультиспектральных индексов](multispectral-index-formulas.md).
