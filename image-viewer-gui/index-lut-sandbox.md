# Песочница индексов/LUT

Песочница индексов/LUT — это интерактивная рабочая область в программе просмотра изображений Chloros, которая позволяет экспериментировать с расчетами мультиспектральных индексов и визуализацией цветов в режиме реального времени. Этот мощный инструмент помогает тестировать различные индексы, уточнять диапазоны значений и создавать готовые к публикации визуализации без повторной обработки всего набора данных.

## Что такое песочница индекса/LUT?

### Назначение

Песочница предоставляет:

* **Расчет индекса в реальном времени** — мгновенное применение любого индекса растительности
* **Интерактивная настройка LUT** — точная настройка цветовых градиентов и диапазонов
* **Оптимизация рабочего процесса** — определение оптимальных настроек перед пакетной обработкой

### Песочница против обработки проекта

**Песочница индекса/LUT (интерактивная):**

* Одно изображение за раз
* Мгновенная обратная связь
* Экспериментальная и итеративная
* Без постоянных изменений в файлах
* Идеально подходит для исследования и тестирования

**Обработка проекта (пакетная):**

* Весь набор данных за раз
* Предварительно настроенные параметры
* Постоянные выходные файлы
* Времяемкий процесс
* Лучше всего подходит, когда настройки окончательно определены

{% hint style=&quot;success&quot; %}
**Оптимальный рабочий процесс**: используйте Sandbox для экспериментов и поиска оптимальных настроек индекса и LUT, а затем примените эти настройки во время обработки проекта для всего набора данных.
{% endhint %}

***

## Работа с индексом/LUT Sandbox

### Понимание предварительно рассчитанных индексов

В Chloros индексы могут применяться во время обработки проекта. Чтобы определить, какие настройки индекса и LUT вы хотите применить к экспорту, проще всего использовать песочницу просмотрщика изображений.

Песочница позволяет вам:

* **Применять новые индексы и цветовые градиенты (LUT)** для визуализации данных.
* **Настраивать параметры визуализации** в интерактивном режиме.
* **Просматривать** уже рассчитанные индексные изображения.
* **Проверять** значения пикселей на всех уровнях масштабирования.

### Открытие песочницы

Доступ к песочнице индекса/LUT осуществляется на вкладке **Просмотрщик изображений** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> :

1. Щелкните изображение в сетке файлового браузера, оно откроется на вкладке **Просмотрщик изображений** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> .
2. Щелкните вкладку **Image Viewer** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> , чтобы открыть левую всплывающую боковую панель, если она еще не открыта

### Выбор изображения для применения индекса/LUT

Для работы с индексом в просмотрщике изображений <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> песочницы:

1. **Откройте изображение** из основной сетки изображений, щелкнув по нему
2. Откроется вкладка **Image Viewer** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> откроется вкладка **Просмотрщик изображений**
3. Нажмите на **выпадающий список Слои** (в правом верхнем углу просмотрщика)
4. Выберите слой из выпадающего списка:
   * RAW (отражение)

### Применение индекса к изображению

Когда изображение отображается в полноэкранном режиме и открыта боковая панель вкладки **Просмотрщик изображений** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> открыта:

1. Установите флажок «Индекс» в верхней части боковой панели.
2. Выберите фильтр вашей камеры из раскрывающегося списка слева.
3. Выберите желаемую формулу индекса из раскрывающегося списка справа.
4. Перетащите цветные кружки каналов фильтра в места в формуле индекса ниже.
5. Как только формула будет действительна, изображение обновится и покажет значения индекса.
6. Перемещайте курсор мыши, чтобы увидеть значения в месте нахождения курсора.
7. Увеличьте масштаб, чтобы увидеть отдельные пиксели и связанные с ними значения.

Каждый индекс имеет определенный диапазон значений и значение:

#### NDVI Пример

```
Formula: (NIR - Red) / (NIR + Red)

For Survey3W RGN camera:
NIR = 850nm band
Red = 661nm band

Result range: -1.0 to +1.0
Typical vegetation: 0.4 to 0.9
Stressed vegetation: 0.2 to 0.4
Bare soil: 0.0 to 0.2
Water: -0.1 to 0.1
```

Полную документацию по формулам индекса см. в разделе [Формулы мультиспектральных индексов](../project-settings/multispectral-index-formulas.md).

***

## Работа с LUT (таблицами просмотра)

### Что такое LUT?

**Таблица просмотра (LUT)** сопоставляет числовые значения индекса с цветами для визуализации:

* **Входные данные**: значение пикселя индекса (например, NDVI 0,65)
* **Выход**: цвет RGB (например, ярко-зеленый)
* **Цель**: облегчить восприятие и интерпретацию паттернов

**Таблица перевода в оттенки серого и таблица перевода в цвета:**

* Оттенки серого: научный и нейтральный подход, отображение исходных данных
* Таблица перевода в цвета: интуитивный и эффектный подход, выделение паттернов и различий

{% hint style=&quot;success&quot; %}
**Возможности визуализации**: Применение цветной LUT к индексной изображению в оттенках серого значительно упрощает идентификацию паттернов, аномалий и областей, представляющих интерес, с одного взгляда.
{% endhint %}

### Применение LUT к индексному изображению

После получения индексного изображения, показывающего

1. Нажмите кнопку <img src="../.gitbook/assets/image.png" alt="" data-size="line"> кнопку «+Добавить LUT»
2. Выберите цветовой градиент
3. Отрегулируйте минимальные/максимальные конечные точки обрезки
4. Отрегулируйте режим обрезки
5. Установите флажок «Индекс» на панели вкладок **Просмотрщик изображений** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> , чтобы применить LUT.

### Выбор цветового градиента

**Выбор градиента:**

1. На панели LUT найдите **цветную полосу градиента**.
2. Наведите на нее курсор мыши, чтобы просмотреть доступные предустановленные градиенты.
3. Выберите желаемый градиент.
4. Изображение **немедленно обновится** с новыми цветами, когда будет установлен флажок «Индекс».

{% hint style=&quot;success&quot; %}
**Рекомендации**: Для индексов растительности, таких как NDVI, градиент Red-Yellow-Green является наиболее интуитивным, поскольку он соответствует естественным цветовым ассоциациям (зеленый = здоровый, желтый = умеренный, красный = стресс).
{% endhint %}

### Настройка цветовых классов

**Элемент управления «Классы»** определяет, сколько дискретных цветовых ступеней будет отображаться в градиенте:

**Варианты количества классов:**

* **2–5 классов**: очень широкие категории, четкие зоны
* **6-10 классов**: сбалансированные, подходят для классификации
* **11-20 классов**: плавные градиенты, непрерывный вид
* **20+ классов**: почти непрерывные, максимальная плавность

**Как настроить:**

1. На панели LUT найдите **квадраты с образцами цветов под полосой градиента**
2. Настройте количество классов, добавляя их с помощью кнопки +
3. Удалите количество классов, дважды щелкнув по цветовому образцу
4. Градиент обновляется **в режиме реального времени** на изображении

**Влияние на визуализацию:**

* **Меньшее количество классов** (3-5): создает четкие зоны, упрощает классификацию, облегчает различение категорий
* **Среднее количество классов** (6-10): сбалансированный подход, подходит для большинства приложений.
* **Больше классов** (15-20): плавные переходы, детальные вариации, фотографический вид.

**Когда использовать:**

* **Немного классов (3-5)**: презентационные слайды, карты классификации, простые отчеты.
* **Среднее количество классов (6-10)**: общий анализ, сбалансированная детализация, стандартные отчеты.
* **Много классов (15-20)**: научный анализ, детальная проверка, результаты публикационного качества

### Точная настройка диапазонов значений

**Элементы управления диапазоном значений** определяют, какие значения индекса сопоставляются с какими цветами в вашем градиенте:

**Элементы управления диапазоном на панели LUT:**

* **Минимальное значение**: нижняя граница цветовой шкалы
* **Максимальное значение**: верхняя граница цветовой шкалы
* **Промежуточные значения**: автоматически распределяются между минимальным и максимальным значениями (в зависимости от количества классов)

#### Настройка минимальных/максимальных значений

**Чтобы настроить диапазоны значений:**

1. На панели LUT найдите поля ввода **Минимальное значение** и **Максимальное значение**
2. Щелкните поле **Минимальное значение**
3. Введите желаемое минимальное значение (например, `0.2`).
4. Нажмите **Enter** или щелкните за пределами поля.
5. Повторите для поля **Макс. значение** (например, `0.9`).
6. Визуализация **обновится немедленно**.

{% hint style=&quot;info&quot; %}
**Автоматическое масштабирование**: при первом применении LUT Chloros автоматически устанавливает минимальное/максимальное значение в соответствии с фактическим диапазоном данных в изображении. Затем вы можете сузить этот диапазон, чтобы сосредоточиться на конкретных диапазонах значений, представляющих интерес.
{% endhint %}

**Примеры настройки диапазона NDVI:**

* **Полный диапазон**: `-1.0` до `1.0` (показать все возможные значения)
* **С фокусом на растительность**: `0.2` до `0.9` (исключить голую почву и воду)
* **Только здоровая растительность**: от `0.5` до `0.9` (выделять только сильные растения)
* **Обнаружение стресса**: от `0.2` до `0.5` (выделить проблемные области)
* **Пользовательский диапазон**: настройте на основе наблюдаемых значений пикселей

**Зачем настраивать диапазоны?**

* **Увеличить контраст** в интересующей вас области
* **Исключить нерелевантные значения** (например, водоемы, голая почва)
* **Стандартизировать визуализацию** для нескольких изображений или дат
* **Выделить незначительные различия** в узком диапазоне значений

### Обрезка значений, выходящих за пределы диапазона

Когда значения пикселей выходят за пределы заданного минимального/максимального диапазона, вы можете контролировать их отображение с помощью **режимов обрезки**.

#### **Доступные варианты режимов обрезки:**

#### 1. Минимальное и максимальное

* Пиксели **ниже минимального значения** → отображение с использованием **первого цвета** в градиенте (например, красный)
* Пиксели **выше максимального значения** → отображаются с использованием **последнего цвета** в градиенте (например, зеленого)
* **Пример использования**: выделение экстремальных значений, отображение полного диапазона данных с насыщенными цветами на границах
* **Пример**: значения NDVI ниже 0,2 отображаются красным цветом, значения выше 0,9 отображаются зеленым цветом

#### 2. Прозрачный фон

* Пиксели **за пределами диапазона** становятся **полностью прозрачными**
* Только пиксели **в пределах диапазона** отображают цветовой градиент
* **Пример использования**: наложение ГИС, выделение определенных диапазонов значений, выделение только интересующих областей
* **Пример**: отображение только NDVI 0,4-0,7 в цвете, все остальное прозрачно

{% hint style=&quot;warning&quot; %}
**Ограничение прозрачности**: прозрачные пиксели будут отображаться в программе просмотра как цвет фона. При экспорте во время обработки прозрачность сохраняется в формате PNG, но не в формате JPG.
{% endhint %}

#### 3. Фон индекса

* Пиксели **за пределами диапазона** отображаются в **оттенках серого** (показывая исходные значения индекса)
* Пиксели **в пределах диапазона** отображаются **цветовым градиентом**
* **Пример использования**: Нежное выделение, сохранение контекста при одновременном выделении областей, представляющих интерес.
* **Пример**: Цветное выделение стрессовой растительности (NDVI 0,3-0,5) при отображении здоровых областей в сером цвете.

#### 4. Исходный фон

* Пиксели **за пределами диапазона** отображаются в виде **исходного мультиспектрального изображения**.
* Пиксели **в пределах диапазона** отображают **цветовой градиент**
* **Пример использования**: Наиболее интуитивный — сочетает естественный контекст изображения с аналитическим цветовым наложением
* **Пример**: Просмотр фактического вида поля/урожая с наложением цветовой кодировки стрессовых областей

### Выбор подходящего режима обрезки

| Режим обрезки              | Лучше всего подходит для                                   | Стиль визуализации          |
| -------------------------- | ------------------------------------------ | ---------------------------- |
| **Минимальное и максимальное**    | Полное отображение данных, научный анализ     | Все пиксели окрашены           |
| **Прозрачный фон** | Наложения GIS, выделение определенных диапазонов    | Цвет в диапазоне, за пределами диапазона — пустое пространство |
| **Фон индекса**       | Незначительное выделение, сохранение контекста данных  | Цвет в диапазоне, за пределами диапазона — серый цвет  |
| **Оригинальный фон**    | Отчеты, презентации, интуитивный анализ | Цвет в диапазоне, за пределами диапазона — фотография |

### Создание пользовательских цветов LUT

Для полного контроля над визуализацией вы можете создавать **пользовательские цветовые градиенты**, редактируя отдельные цветовые остановки.

**Чтобы создать пользовательский градиент:**

1. На панели LUT найдите **панель предварительного просмотра градиента**
2. Найдите **квадраты с образцами цветов** под градиентом
3. **Щелкните цветовую остановку**, чтобы выбрать ее
4. Откроется **палитра цветов**.
5. Выберите новый цвет с помощью:
   * **Цветового круга**: визуальный выбор цвета.
   * **Ползунков RGB/HSV**: точное управление цветом.
   * **Ввода шестнадцатеричного кода**: точное указание цвета (например, `#FF0000` для красного).
6. Щелкните за пределами палитры цветов, **чтобы применить новый цвет**.
7. Градиент **немедленно обновится** на изображении.

**Добавление или удаление цветовых остановок:**

* **Добавить остановку**: щелкните значок «+», чтобы добавить новый образец в конец.
* **Удалить остановку**: дважды щелкните квадрат цвета, чтобы удалить образец.

**Стратегии настройки:**

* **Инвертировать градиент**: переверните порядок цветов, чтобы изменить значение (например, зеленый = низкий, красный = высокий)
* **Цвета бренда**: подберите цветовую палитру вашей организации для отчетов
* **Подходит для людей с дальтонизмом**: используйте комбинации оранжевого и синего или фиолетового и желтого
* **Оптимизация печати**: выбирайте цвета, которые подходят как для цветной, так и для черно-белой печати
* **Мультипороговое значение**: используйте отличные цвета при определенных пороговых значениях для классификации

{% hint style=&quot;info&quot; %}
**Сохранение настраиваемых градиентов**: настраиваемые градиенты можно сохранять и использовать повторно. Щелкните значок сохранения на панели LUT, чтобы сохранить настраиваемые цветовые схемы для использования в будущем.
{% endhint %}

***

## Интерактивный рабочий процесс

### Обновления в реальном времени

Все настройки LUT в песочнице обновляют изображение **мгновенно и интерактивно**:

* **Переключение слоя** → Изображение меняется немедленно
* **Выбор градиента** → Цвета обновляются мгновенно
* **Настройка диапазона значений** → Контрастность изменяется в режиме реального времени
* **Изменение классов** → Плавкость градиента обновляется немедленно
* **Изменение обрезки** → Отображение фона изменяется мгновенно
* **Редактирование цветов** → Пользовательский градиент применяется немедленно

**Кнопка «Применить» не требуется** — все изменения происходят в режиме реального времени и интерактивно!

{% hint style=&quot;success&quot; %}
**Мгновенная обратная связь**: мгновенная визуальная обратная связь позволяет быстро экспериментировать с различными настройками, пока вы не найдете оптимальную визуализацию для ваших аналитических потребностей.
{% endhint %}

### Итеративный процесс уточнения

**Типичный процесс оптимизации LUT:**

1. **Выберите индексный слой** (например, RAW (отражение)).
2. **Примените индекс** — выберите фильтр камеры и формулу индекса, перетащите цветные кружки в соответствующее место в формуле индекса.
3. **Применить градиент LUT** — начните с предустановки Red-Yellow-Green
4. **Проверить значения пикселей** — перемещайте курсор, обратите внимание на диапазоны значений
5. **Настройте мин/макс** — сузьте диапазон, чтобы сосредоточиться на растительности (например, от 0,2 до 0,9)
6. **Выберите обрезку** — попробуйте «Оригинальный фон» для контекста
7. **Уточните цвета** — при необходимости настройте градиент для особого акцента
8. **Завершите настройки** — задокументируйте настройки и скопируйте их в настройки проекта для экспорта

### Проверка значений пикселей

Понимание фактических значений пикселей имеет решающее значение для установки эффективных диапазонов LUT:

**Как проверять значения:**

1. Значения пикселей отображаются, когда для изображения **отмечены** либо поле «Индекс», либо поля «Индекс» и «LUT».
2. **Наведите курсор** на разные области изображения
3. **Наблюдайте за значениями пикселей**, отображаемыми в легенде при наведении курсора
4. Увеличьте масштаб, чтобы увидеть отдельные пиксели, выделенные плавающим значением
5. **Запишите** диапазоны значений для различных характеристик:
   * **Здоровая растительность**: например, NDVI 0,55–0,85.
   * **Растительность, подверженная стрессу**: например, NDVI 0,30–0,50.
   * **Голая почва**: например, NDVI 0,05–0,25
   * **Вода** (если присутствует): например, NDVI от -0,05 до 0,10

**Использование значений пикселей для настройки диапазонов LUT:**

После проверки значений пикселей отрегулируйте минимальное/максимальное значение LUT соответствующим образом:

**Пример сценария:**

* **Наблюдение**: Значения почвы = 0,05–0,25, стресс = 0,25–0,50, здоровье = 0,50–0,85
* **Цель**: визуализировать только здоровье растений (исключить почву)
* **Настройки LUT**: мин. = `0.25`, макс. = `0.85`
* **Обрезка**: «Оригинальный фон», чтобы увидеть почву в естественном цвете
* **Результат**: цветовой градиент применяется только к растительности, почва отображается как исходное изображение

{% hint style=&quot;info&quot; %}
**Динамический диапазон**: Различные культуры, сезоны и стадии роста будут иметь разные диапазоны значений. Всегда проверяйте значения пикселей в вашем конкретном наборе данных перед установкой диапазонов LUT.
{% endhint %}

***

## Пользовательские индексы (Chloros+)

### Создание формул пользовательских индексов

{% hint style=&quot;info&quot; %}
**Где создавать**: Пользовательские индексы можно настроить в **Настройках проекта** перед обработкой, а также в боковой панели Image Viewer sandbox.
{% endhint %}

**Чтобы создать пользовательский индекс:**

1. **Откройте настройки проекта** (перед обработкой) или боковую панель Image Viewer sandbox.
2. Перейдите к **выпадающему списку формул индекса**.
3. Найдите опцию **«Пользовательский»** (необходимо войти в систему с лицензией Chloros+).
4. **Определите формулу** с помощью переменных диапазона:
   * Названия диапазонов: `NIR`, `Red`, `Green`, `Blue`, `RedEdge` и т. д.
   * Операторы: `+`, `-`, `*`, `/`, `^` (экспонента)
   * Функции: `sqrt()`, `abs()` и т. д. (если поддерживается)
   * Скобки: `()` для порядка операций
5. **Назовите свой индекс** (например, «MyIndex» или «CustomNDVI»)
6. **Сохраните конфигурацию**

**Примеры пользовательских формул:**

```
Modified NDVI with offset:
(NIR - Red) / (NIR + Red + 0.5)

Simple ratio:
NIR / Red

Complex multi-band:
(NIR - Red) / (NIR + Red - Blue)

Exponential index:
(NIR / Red) ^ 2
```

{% hint style=&quot;warning&quot; %}
**Проверка формулы**: убедитесь, что ваша формула использует полосы, доступные в вашей камере. Например, RedEdge доступен только на камерах с фильтром RedEdge.
{% endhint %}

***

## Следующие шаги

Теперь, когда вы понимаете, что такое песочница индексов/LUT:

* **Применить к обработке**: используйте найденные настройки в [Настройках проекта](../project-settings/project-settings.md)
* **Пакетная обработка**: примените оптимизированные индексы к полным наборам данных
* **Узнайте больше**: прочитайте [Формулы мультиспектральных индексов](../project-settings/multispectral-index-formulas.md)

Связанная документация:

* [**Слои изображений**](image-layers.md) — управление слоями и визуализация
* [**Открытие изображения в полноэкранном режиме**](opening-an-image-full-screen.md) — основы работы с просмотрщиком изображений
* [**Обработка изображений (GUI)**](../processing-images-gui/adding-files-to-a-project.md) — полный рабочий процесс обработки
